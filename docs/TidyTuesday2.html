<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Tidy Tuesday: Week 23</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/table1-1.0/table1_defaults.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Data Analysis Portfolio</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="./aboutme.html">About Me</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./rcoding.html">R Coding</a>
    </li>
    <li>
      <a href="./visualization.html">Visualization</a>
    </li>
    <li>
      <a href="./tidytuesday.html">Tidy Tuesday #1</a>
    </li>
    <li>
      <a href="./TidyTuesday2.html">Tidy Tuesday #2</a>
    </li>
    <li>
      <a href="./files/analysis3 copy.html">Machine Learning Modeling</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/sophiadrew/SophiaPDrewry-MADA-Portfolio">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Tidy Tuesday: Week 23</h1>

</div>


<p>Downloading packages and data</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nberwp) <span class="co">#to clean and arrange data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</code></pre>
<pre><code>## ✓ ggplot2 3.3.5     ✓ purrr   0.3.4
## ✓ tibble  3.1.6     ✓ dplyr   1.0.7
## ✓ tidyr   1.1.4     ✓ stringr 1.4.0
## ✓ readr   2.0.2     ✓ forcats 0.5.1</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes) <span class="co">#for cool graphs</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;janitor&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     chisq.test, fisher.test</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stats)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggalt)</span></code></pre></div>
<pre><code>## Registered S3 methods overwritten by &#39;ggalt&#39;:
##   method                  from   
##   grid.draw.absoluteGrob  ggplot2
##   grobHeight.absoluteGrob ggplot2
##   grobWidth.absoluteGrob  ggplot2
##   grobX.absoluteGrob      ggplot2
##   grobY.absoluteGrob      ggplot2</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;tune&#39;:
##   method                   from   
##   required_pkgs.model_spec parsnip</code></pre>
<pre><code>## ── Attaching packages ────────────────────────────────────── tidymodels 0.1.4 ──</code></pre>
<pre><code>## ✓ broom        0.7.10     ✓ rsample      0.1.1 
## ✓ dials        0.0.10     ✓ tune         0.1.6 
## ✓ infer        1.0.0      ✓ workflows    0.2.4 
## ✓ modeldata    0.1.1      ✓ workflowsets 0.1.0 
## ✓ parsnip      0.1.7      ✓ yardstick    0.0.8 
## ✓ recipes      0.1.17</code></pre>
<pre><code>## ── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
## x scales::discard() masks purrr::discard()
## x dplyr::filter()   masks stats::filter()
## x recipes::fixed()  masks stringr::fixed()
## x dplyr::lag()      masks stats::lag()
## x yardstick::spec() masks readr::spec()
## x recipes::step()   masks stats::step()
## • Use tidymodels_prefer() to resolve common conflicts.</code></pre>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;rpart&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dials&#39;:
## 
##     prune</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span></code></pre></div>
<pre><code>## Loading required package: foreach</code></pre>
<pre><code>## 
## Attaching package: &#39;foreach&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     accumulate, when</code></pre>
<pre><code>## Loading required package: iterators</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code></pre></div>
<pre><code>## Loading required package: Matrix</code></pre>
<pre><code>## 
## Attaching package: &#39;Matrix&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:tidyr&#39;:
## 
##     expand, pack, unpack</code></pre>
<pre><code>## Loaded glmnet 4.1-3</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data from the Tidy Tuesday Github</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>marbles <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-06-02/marbles.csv&#39;</span>)</span></code></pre></div>
<pre><code>## Rows: 256 Columns: 14</code></pre>
<pre><code>## ── Column specification ────────────────────────────────────────────────────────
## Delimiter: &quot;,&quot;
## chr (9): date, race, site, source, marble_name, team_name, pole, host, notes
## dbl (5): time_s, points, track_length_m, number_laps, avg_time_lap</code></pre>
<pre><code>## 
## ℹ Use `spec()` to retrieve the full column specification for this data.
## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div id="data-cleaning-and-pre-processing" class="section level2">
<h2>Data Cleaning and Pre-processing</h2>
<p>Now for a little bit of data cleaning</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(marbles)</span></code></pre></div>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">marbles</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">256</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">14</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">9</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">5</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">8</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">race</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">4</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">site</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">7</td>
<td align="right">15</td>
<td align="right">0</td>
<td align="right">8</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">source</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">34</td>
<td align="right">34</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">marble_name</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">4</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">32</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">team_name</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">6</td>
<td align="right">16</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">pole</td>
<td align="right">128</td>
<td align="right">0.50</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">16</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">host</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">2</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">notes</td>
<td align="right">249</td>
<td align="right">0.03</td>
<td align="right">37</td>
<td align="right">100</td>
<td align="right">0</td>
<td align="right">7</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">time_s</td>
<td align="right">3</td>
<td align="right">0.99</td>
<td align="right">190.84</td>
<td align="right">169.13</td>
<td align="right">17.76</td>
<td align="right">28.40</td>
<td align="right">36.28</td>
<td align="right">338.16</td>
<td align="right">492.01</td>
<td align="left">▇▁▁▇▁</td>
</tr>
<tr class="even">
<td align="left">points</td>
<td align="right">128</td>
<td align="right">0.50</td>
<td align="right">6.45</td>
<td align="right">7.74</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
<td align="right">3.00</td>
<td align="right">11.25</td>
<td align="right">26.00</td>
<td align="left">▇▂▂▁▁</td>
</tr>
<tr class="odd">
<td align="left">track_length_m</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">13.22</td>
<td align="right">0.95</td>
<td align="right">11.90</td>
<td align="right">12.62</td>
<td align="right">13.02</td>
<td align="right">14.13</td>
<td align="right">14.55</td>
<td align="left">▅▅▂▁▇</td>
</tr>
<tr class="even">
<td align="left">number_laps</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">6.25</td>
<td align="right">5.53</td>
<td align="right">1.00</td>
<td align="right">1.00</td>
<td align="right">5.00</td>
<td align="right">10.25</td>
<td align="right">16.00</td>
<td align="left">▇▁▃▂▂</td>
</tr>
<tr class="odd">
<td align="left">avg_time_lap</td>
<td align="right">3</td>
<td align="right">0.99</td>
<td align="right">29.70</td>
<td align="right">5.55</td>
<td align="right">17.76</td>
<td align="right">25.94</td>
<td align="right">30.05</td>
<td align="right">33.65</td>
<td align="right">41.62</td>
<td align="left">▃▆▇▇▂</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(marbles)</span></code></pre></div>
<pre><code>## spec_tbl_df [256 × 14] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ date          : chr [1:256] &quot;15-Feb-20&quot; &quot;15-Feb-20&quot; &quot;15-Feb-20&quot; &quot;15-Feb-20&quot; ...
##  $ race          : chr [1:256] &quot;S1Q1&quot; &quot;S1Q1&quot; &quot;S1Q1&quot; &quot;S1Q1&quot; ...
##  $ site          : chr [1:256] &quot;Savage Speedway&quot; &quot;Savage Speedway&quot; &quot;Savage Speedway&quot; &quot;Savage Speedway&quot; ...
##  $ source        : chr [1:256] &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot; &quot;https://youtu.be/JtsQ_UydjEI?t=356&quot; ...
##  $ marble_name   : chr [1:256] &quot;Clementin&quot; &quot;Starry&quot; &quot;Momo&quot; &quot;Yellow&quot; ...
##  $ team_name     : chr [1:256] &quot;O&#39;rangers&quot; &quot;Team Galactic&quot; &quot;Team Momo&quot; &quot;Mellow Yellow&quot; ...
##  $ time_s        : num [1:256] 28.1 28.4 28.4 28.7 28.7 ...
##  $ pole          : chr [1:256] &quot;P1&quot; &quot;P2&quot; &quot;P3&quot; &quot;P4&quot; ...
##  $ points        : num [1:256] NA NA NA NA NA NA NA NA NA NA ...
##  $ track_length_m: num [1:256] 12.8 12.8 12.8 12.8 12.8 ...
##  $ number_laps   : num [1:256] 1 1 1 1 1 1 1 1 1 1 ...
##  $ avg_time_lap  : num [1:256] 28.1 28.4 28.4 28.7 28.7 ...
##  $ host          : chr [1:256] &quot;No&quot; &quot;No&quot; &quot;No&quot; &quot;No&quot; ...
##  $ notes         : chr [1:256] NA NA NA NA ...
##  - attr(*, &quot;spec&quot;)=
##   .. cols(
##   ..   date = col_character(),
##   ..   race = col_character(),
##   ..   site = col_character(),
##   ..   source = col_character(),
##   ..   marble_name = col_character(),
##   ..   team_name = col_character(),
##   ..   time_s = col_double(),
##   ..   pole = col_character(),
##   ..   points = col_double(),
##   ..   track_length_m = col_double(),
##   ..   number_laps = col_double(),
##   ..   avg_time_lap = col_double(),
##   ..   host = col_character(),
##   ..   notes = col_character()
##   .. )
##  - attr(*, &quot;problems&quot;)=&lt;externalptr&gt;</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now to fix this funky date format</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>marbles <span class="ot">&lt;-</span> marbles <span class="sc">%&gt;%</span> <span class="fu">separate</span>(date, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;day&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;year&quot;</span>))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>marbles<span class="sc">$</span>month <span class="ot">&lt;-</span><span class="fu">match</span>(marbles<span class="sc">$</span>month, month.abb)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>marbles<span class="sc">$</span>date <span class="ot">&lt;-</span><span class="fu">with</span>(marbles,<span class="fu">paste</span>(month, day, year, <span class="at">sep=</span><span class="st">&quot;/&quot;</span>),<span class="st">&quot;%m/%d/%y&quot;</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>marbles<span class="sc">$</span>date <span class="ot">&lt;-</span><span class="fu">as.Date</span>(marbles<span class="sc">$</span>date, <span class="at">format=</span><span class="st">&quot;%m/%d/%y&quot;</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Getting rid of unwanted variables</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>marbles<span class="ot">&lt;-</span> <span class="fu">subset</span>(marbles, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(source, host, notes, day, month, year))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>marbles <span class="ot">&lt;-</span> marbles[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">64</span>, <span class="dv">128</span>, <span class="dv">192</span>), ] <span class="co"># deleting row 192 because that is the only time a marble did not compete for a reason </span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># I want to compare speed across races, so I will create a second per meter variable</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>marbles<span class="sc">$</span>mps <span class="ot">&lt;-</span> (marbles<span class="sc">$</span>track_length_m <span class="sc">*</span> marbles<span class="sc">$</span>number_laps)<span class="sc">/</span> marbles<span class="sc">$</span>time_s </span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># ranking the place by time</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>marbles <span class="ot">=</span> marbles <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(race) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">rank</span>(time_s))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a season summary table</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>season <span class="ot">&lt;-</span> marbles <span class="sc">%&gt;%</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="fu">funs</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))) <span class="sc">%&gt;%</span> </span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(team_name, marble_name) <span class="sc">%&gt;%</span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">PR =</span> <span class="fu">min</span>(mps), <span class="at">PW =</span> <span class="fu">max</span>(mps), <span class="at">SPM =</span> <span class="fu">mean</span>(mps), <span class="at">Rank =</span> <span class="fu">mean</span>(rank), <span class="at">Points =</span> <span class="fu">sum</span>(points))</span></code></pre></div>
<pre><code>## `mutate_if()` ignored the following grouping variables:
## Column `race`</code></pre>
<pre><code>## Warning: `funs()` was deprecated in dplyr 0.8.0.
## Please use a list of either functions or lambdas: 
## 
##   # Simple named list: 
##   list(mean = mean, median = median)
## 
##   # Auto named with `tibble::lst()`: 
##   tibble::lst(mean, median)
## 
##   # Using lambdas
##   list(~ mean(., trim = .2), ~ median(., na.rm = TRUE))
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<pre><code>## `summarise()` has grouped output by &#39;team_name&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model dataset</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">subset</span>(marbles, <span class="at">select =</span> <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">11</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(model) <span class="co"># rank should be a factor</span></span></code></pre></div>
<pre><code>## tibble [253 × 6] (S3: tbl_df/tbl/data.frame)
##  $ time_s        : num [1:253] 28.1 28.4 28.4 28.7 28.7 ...
##  $ track_length_m: num [1:253] 12.8 12.8 12.8 12.8 12.8 ...
##  $ number_laps   : num [1:253] 1 1 1 1 1 1 1 1 1 1 ...
##  $ avg_time_lap  : num [1:253] 28.1 28.4 28.4 28.7 28.7 ...
##  $ mps           : num [1:253] 0.456 0.452 0.451 0.446 0.446 ...
##  $ rank          : num [1:253] 1 2 3 4 5 6 7 8 9 10 ...</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>model<span class="sc">$</span>rank <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(model<span class="sc">$</span>rank)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model<span class="sc">$</span>mps,<span class="at">col=</span><span class="st">&#39;red&#39;</span>) <span class="co"># ok distribution looks good</span></span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="exploratory-data-analysis" class="section level1">
<h1>Exploratory data analysis</h1>
<p>First lets look at the overall performance by score over time</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Marble stats by team</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>Table1 <span class="ot">&lt;-</span> table1<span class="sc">::</span><span class="fu">table1</span>(<span class="sc">~</span>mps <span class="sc">+</span> rank <span class="sc">+</span> points <span class="sc">+</span> avg_time_lap <span class="sc">|</span> team_name, <span class="at">data =</span> marbles)</span></code></pre></div>
<pre><code>## Warning in .table1.internal(x = x, labels = labels, groupspan = groupspan, :
## Table has 17 columns. Are you sure this is what you want?</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>Table1</span></code></pre></div>
<div class="Rtable1"><table class="Rtable1">
<thead>
<tr>
<th class='rowlabel firstrow lastrow'></th>
<th class='firstrow lastrow'><span class='stratlabel'>Balls of Chaos<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Green Ducks<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Hazers<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Hornets<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Limers<br><span class='stratn'>(N=15)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Mellow Yellow<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Midnight Wisps<br><span class='stratn'>(N=15)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>O'rangers<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Raspberry Racers<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Rojo Rollers<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Savage Speeders<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Snowballs<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Team Galactic<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Team Momo<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Team Primary<br><span class='stratn'>(N=15)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Thunderbolts<br><span class='stratn'>(N=16)</span></span></th>
<th class='firstrow lastrow'><span class='stratlabel'>Overall<br><span class='stratn'>(N=253)</span></span></th>
</tr>
</thead>
<tbody>
<tr>
<td class='rowlabel firstrow'>mps</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>0.451 (0.0691)</td>
<td>0.458 (0.0657)</td>
<td>0.465 (0.0722)</td>
<td>0.451 (0.0651)</td>
<td>0.452 (0.0704)</td>
<td>0.463 (0.0739)</td>
<td>0.463 (0.0644)</td>
<td>0.461 (0.0671)</td>
<td>0.454 (0.0600)</td>
<td>0.452 (0.0715)</td>
<td>0.463 (0.0781)</td>
<td>0.457 (0.0673)</td>
<td>0.455 (0.0654)</td>
<td>0.457 (0.0718)</td>
<td>0.455 (0.0845)</td>
<td>0.457 (0.0685)</td>
<td>0.457 (0.0679)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>0.432 [0.356, 0.616]</td>
<td class='lastrow'>0.439 [0.357, 0.614]</td>
<td class='lastrow'>0.448 [0.357, 0.650]</td>
<td class='lastrow'>0.439 [0.353, 0.631]</td>
<td class='lastrow'>0.424 [0.359, 0.617]</td>
<td class='lastrow'>0.442 [0.361, 0.664]</td>
<td class='lastrow'>0.449 [0.358, 0.616]</td>
<td class='lastrow'>0.444 [0.364, 0.613]</td>
<td class='lastrow'>0.447 [0.357, 0.590]</td>
<td class='lastrow'>0.428 [0.359, 0.646]</td>
<td class='lastrow'>0.438 [0.351, 0.667]</td>
<td class='lastrow'>0.438 [0.354, 0.614]</td>
<td class='lastrow'>0.444 [0.357, 0.607]</td>
<td class='lastrow'>0.436 [0.358, 0.657]</td>
<td class='lastrow'>0.442 [0.350, 0.670]</td>
<td class='lastrow'>0.429 [0.362, 0.621]</td>
<td class='lastrow'>0.438 [0.350, 0.670]</td>
</tr>
<tr>
<td class='rowlabel firstrow'>rank</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>9.84 (5.10)</td>
<td>7.63 (3.65)</td>
<td>5.41 (3.84)</td>
<td>11.3 (3.07)</td>
<td>10.0 (4.76)</td>
<td>7.13 (3.93)</td>
<td>7.90 (4.02)</td>
<td>7.38 (5.08)</td>
<td>9.25 (3.71)</td>
<td>9.63 (3.20)</td>
<td>5.88 (4.66)</td>
<td>8.63 (4.84)</td>
<td>9.19 (4.89)</td>
<td>7.75 (4.92)</td>
<td>9.00 (6.34)</td>
<td>8.81 (4.20)</td>
<td>8.41 (4.57)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>10.8 [1.00, 15.0]</td>
<td class='lastrow'>8.00 [1.00, 13.0]</td>
<td class='lastrow'>4.50 [1.00, 15.0]</td>
<td class='lastrow'>11.5 [7.00, 16.0]</td>
<td class='lastrow'>10.0 [3.50, 16.0]</td>
<td class='lastrow'>7.50 [1.00, 15.0]</td>
<td class='lastrow'>7.00 [1.00, 14.0]</td>
<td class='lastrow'>7.00 [1.00, 15.0]</td>
<td class='lastrow'>8.50 [3.00, 16.0]</td>
<td class='lastrow'>9.50 [5.00, 15.0]</td>
<td class='lastrow'>5.50 [1.00, 16.0]</td>
<td class='lastrow'>9.50 [1.00, 15.0]</td>
<td class='lastrow'>10.0 [1.00, 15.0]</td>
<td class='lastrow'>6.50 [1.00, 16.0]</td>
<td class='lastrow'>7.00 [1.00, 16.0]</td>
<td class='lastrow'>9.50 [2.00, 15.0]</td>
<td class='lastrow'>8.00 [1.00, 16.0]</td>
</tr>
<tr>
<td class='rowlabel firstrow'>points</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>5.75 (8.96)</td>
<td>8.00 (9.68)</td>
<td>11.8 (8.41)</td>
<td>1.00 (2.14)</td>
<td>3.57 (5.77)</td>
<td>5.50 (5.66)</td>
<td>4.86 (6.34)</td>
<td>8.63 (9.23)</td>
<td>3.38 (3.07)</td>
<td>4.00 (4.11)</td>
<td>12.6 (7.96)</td>
<td>8.25 (9.48)</td>
<td>8.00 (10.7)</td>
<td>6.13 (8.39)</td>
<td>7.71 (7.52)</td>
<td>6.13 (8.36)</td>
<td>6.61 (7.77)</td>
</tr>
<tr>
<td class='rowlabel'>Median [Min, Max]</td>
<td>0.500 [0, 25.0]</td>
<td>3.00 [0, 26.0]</td>
<td>14.0 [0, 25.0]</td>
<td>0 [0, 6.00]</td>
<td>0 [0, 12.0]</td>
<td>4.00 [0, 15.0]</td>
<td>1.00 [0, 15.0]</td>
<td>6.00 [0, 25.0]</td>
<td>3.00 [0, 8.00]</td>
<td>2.50 [0, 10.0]</td>
<td>13.0 [0, 25.0]</td>
<td>5.00 [0, 25.0]</td>
<td>4.00 [0, 25.0]</td>
<td>4.00 [0, 25.0]</td>
<td>12.0 [0, 18.0]</td>
<td>1.00 [0, 19.0]</td>
<td>4.00 [0, 26.0]</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Missing</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (53.3%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (53.3%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>8 (53.3%)</td>
<td class='lastrow'>8 (50.0%)</td>
<td class='lastrow'>128 (50.6%)</td>
</tr>
<tr>
<td class='rowlabel firstrow'>avg_time_lap</td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
<td class='firstrow'></td>
</tr>
<tr>
<td class='rowlabel'>Mean (SD)</td>
<td>30.1 (5.77)</td>
<td>29.6 (5.55)</td>
<td>29.2 (5.63)</td>
<td>30.0 (5.54)</td>
<td>30.2 (5.61)</td>
<td>29.4 (5.66)</td>
<td>29.1 (5.33)</td>
<td>29.4 (5.58)</td>
<td>29.7 (5.45)</td>
<td>30.0 (5.73)</td>
<td>29.4 (5.98)</td>
<td>29.7 (5.74)</td>
<td>29.8 (5.69)</td>
<td>29.7 (5.62)</td>
<td>30.2 (6.81)</td>
<td>29.7 (5.58)</td>
<td>29.7 (5.55)</td>
</tr>
<tr>
<td class='rowlabel lastrow'>Median [Min, Max]</td>
<td class='lastrow'>31.0 [19.3, 40.9]</td>
<td class='lastrow'>29.6 [19.4, 40.8]</td>
<td class='lastrow'>29.7 [18.3, 40.8]</td>
<td class='lastrow'>30.0 [18.9, 41.2]</td>
<td class='lastrow'>30.8 [19.3, 40.5]</td>
<td class='lastrow'>29.8 [17.9, 40.3]</td>
<td class='lastrow'>30.0 [19.3, 40.6]</td>
<td class='lastrow'>29.6 [19.4, 40.0]</td>
<td class='lastrow'>30.3 [20.2, 40.8]</td>
<td class='lastrow'>30.1 [18.4, 40.6]</td>
<td class='lastrow'>30.0 [17.9, 41.4]</td>
<td class='lastrow'>29.8 [19.4, 41.1]</td>
<td class='lastrow'>30.3 [19.6, 40.7]</td>
<td class='lastrow'>30.0 [18.1, 40.6]</td>
<td class='lastrow'>29.8 [17.8, 41.6]</td>
<td class='lastrow'>30.2 [19.2, 40.2]</td>
<td class='lastrow'>30.1 [17.8, 41.6]</td>
</tr>
</tbody>
</table>
</div>
<div id="marble-rank-by-race" class="section level3">
<h3>Marble Rank by Race</h3>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>marbles<span class="sc">$</span>marble_name <span class="ot">=</span> <span class="fu">with</span>(marbles, <span class="fu">reorder</span>(marble_name, rank))</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>P1 <span class="ot">&lt;-</span> marbles <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marble_name, <span class="at">y =</span> rank)) <span class="sc">+</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>date, <span class="at">scales =</span> <span class="st">&#39;free&#39;</span>) <span class="sc">+</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Marble Rank by Race&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_color_ptol</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() </span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(P1)</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="season-total-marble-points" class="section level3">
<h3>Season total Marble Points</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>season<span class="sc">$</span>marble_name <span class="ot">=</span> <span class="fu">with</span>(season, <span class="fu">reorder</span>(marble_name, Points))</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>P2 <span class="ot">&lt;-</span> season <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> marble_name, <span class="at">y =</span> Points, <span class="at">fill=</span>marble_name)) <span class="sc">+</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">alpha=</span>.<span class="dv">6</span>, <span class="at">width=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Season total Marble Points&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_color_ptol</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme_minimal</span>() </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>P2</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
<div id="season-mps-distribution" class="section level3">
<h3>Season MPS distribution</h3>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>marbles<span class="sc">$</span>marble_name <span class="ot">=</span> <span class="fu">with</span>(marbles, <span class="fu">reorder</span>(marble_name, mps))</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>P3 <span class="ot">&lt;-</span> marbles <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>marble_name, <span class="at">y=</span>mps, <span class="at">fill=</span>marble_name)) <span class="sc">+</span> </span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Season MPS distribution&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_ptol</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() </span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>P3</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-6-1.png" width="672" /> ### Season Best and Wost MPS</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>P4<span class="ot">&lt;-</span> season <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> marble_name, <span class="at">x =</span> PR, <span class="at">xend =</span>PW )) <span class="sc">+</span>  </span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_dumbbell</span>(<span class="at">size =</span> <span class="fl">1.0</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">size_x =</span> <span class="dv">3</span>, </span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">size_xend =</span> <span class="dv">3</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>, </span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour_x =</span> <span class="st">&quot;blue&quot;</span>, </span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">colour_xend =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ptol</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Personal Best and Worst MPS Times&quot;</span>,</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Meters Per Second (MPS)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Team Name&quot;</span>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>P4</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-7-1.png" width="672" /> # Investigation on Smoggy from the Hazers Team Regrettably we must inform you that this years 3rd place winner, Smoggy has been accused of lead weighting - a tactic that was outlawed in the 2018 Marbula One tournament. After chemical analysis, Smoggy and the Hazers team will be disqualified from this years leader board. Lets take a look at the Hazer Team Stats.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>hazers <span class="ot">&lt;-</span> <span class="fu">subset</span>(marbles, team_name <span class="sc">==</span> <span class="st">&quot;Hazers&quot;</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>P5 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span>  </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> hazers, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> avg_time_lap, <span class="at">color=</span><span class="st">&quot;Smoggy&quot;</span>)) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> marbles, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> avg_time_lap, <span class="at">color=</span><span class="st">&quot;Group Average&quot;</span>), <span class="at">linetype=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ptol</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Plot 1: Avg Time- Court Evidence for Smoggy v State&quot;</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot; &quot;</span>, <span class="at">y =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>P5</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a> P6 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span>  </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> hazers, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> mps, <span class="at">color=</span><span class="st">&quot;Smoggy&quot;</span>)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> marbles, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> mps, <span class="at">color=</span><span class="st">&quot;Group Average&quot;</span>), <span class="at">linetype=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_ptol</span>(<span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Plot 2: MPS- Court Evidence for Smoggy v State&quot;</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot; &quot;</span>, <span class="at">y =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>P6</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-8-2.png" width="672" /> _______________________________________________________________________________ # Creating models We are going to try out 2 different models 1) Generalized linear model 2) LASSO model 3) Ridge Regression</p>
<p>First lets create a testing and training set ### Data splitting and CV folds Here we are going to split the data randomly into training and testing subsets - Training data will be used to fit the model. - Testing set will be used to evaluate the model.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting a seed for random number generation so if this analysis is reproduced, the same random set will be generated</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Subsetting 70% of data into training and 20% of data into testing</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We using Body Temp to stratify</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>data_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(model, <span class="at">prop =</span> .<span class="dv">7</span>, <span class="at">strata =</span> <span class="st">&quot;mps&quot;</span>) <span class="co"># dont want all the winners in one category</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating training data</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> <span class="fu">training</span>(data_split)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating testing data</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>test_data  <span class="ot">&lt;-</span> <span class="fu">testing</span>(data_split)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 5-fold cross-validation, 5x repeated</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a resample object for our traiinng data</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train_data, <span class="at">v =</span> <span class="dv">5</span>, <span class="at">repeats =</span> <span class="dv">5</span>, <span class="at">strata =</span> <span class="st">&quot;mps&quot;</span>) <span class="co"># mps is my continuous outcome</span></span></code></pre></div>
</div>
<div id="setting-workflows-training-models-model-1" class="section level2">
<h2>Setting workflows &amp; training models: Model 1</h2>
<p>Setting up lr.mod that will be used for the rest of the models</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>lr.mod <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;lm&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span></code></pre></div>
<div id="lm-model-w-dummy" class="section level3">
<h3>LM model w/ dummy</h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Setting up the linear model</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>D.rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mps <span class="sc">~</span> ., <span class="at">data =</span> train_data)  <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(mps) <span class="co">#scaling mps</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflow</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>D.wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lr.mod) <span class="sc">%&gt;%</span> </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(D.rec)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model to training data</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>D.fit <span class="ot">&lt;-</span> </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  D.wflow <span class="sc">%&gt;%</span> </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> train_data)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a><span class="co"># evaluate</span></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>D.fit <span class="sc">%&gt;%</span> </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 22 × 5
##    term           estimate std.error statistic  p.value
##    &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)     8.60     0.353      24.4    1.04e-54
##  2 time_s          0.00667  0.000651   10.3    4.02e-19
##  3 track_length_m  0.457    0.0364     12.5    2.72e-25
##  4 number_laps    -0.200    0.0187    -10.7    2.20e-20
##  5 avg_time_lap   -0.268    0.00780   -34.4    4.26e-74
##  6 rank_X2         0.00420  0.0869      0.0484 9.61e- 1
##  7 rank_X3         0.0162   0.0832      0.195  8.46e- 1
##  8 rank_X3.5      -0.0201   0.153      -0.131  8.96e- 1
##  9 rank_X4        -0.0229   0.0875     -0.262  7.94e- 1
## 10 rank_X5         0.00788  0.0872      0.0903 9.28e- 1
## # … with 12 more rows</code></pre>
</div>
</div>
<div id="null-model" class="section level2">
<h2>Null Model</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create null formula</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>N.rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(mps <span class="sc">~</span> <span class="fl">1.</span>, <span class="at">data =</span> train_data) </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># set workflow</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>N.train.wflow <span class="ot">&lt;-</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lr.mod) <span class="sc">%&gt;%</span> </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(N.rec)</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co"># fitting</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>N.train.fit <span class="ot">&lt;-</span> </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  N.train.wflow <span class="sc">%&gt;%</span> </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> train_data)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="co"># usual</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>N.train.fit <span class="sc">%&gt;%</span> </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1 × 5
##   term        estimate std.error statistic   p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)    0.457   0.00514      88.9 1.57e-147</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(N.train.fit, train_data)</span></code></pre></div>
<pre><code>## # A tibble: 176 × 1
##    .pred
##    &lt;dbl&gt;
##  1 0.457
##  2 0.457
##  3 0.457
##  4 0.457
##  5 0.457
##  6 0.457
##  7 0.457
##  8 0.457
##  9 0.457
## 10 0.457
## # … with 166 more rows</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>N.train.aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(N.train.fit, train_data)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>N.train.aug <span class="sc">%&gt;%</span> <span class="fu">select</span>(mps, .pred) </span></code></pre></div>
<pre><code>## # A tibble: 176 × 2
##      mps .pred
##    &lt;dbl&gt; &lt;dbl&gt;
##  1 0.411 0.457
##  2 0.395 0.457
##  3 0.394 0.457
##  4 0.393 0.457
##  5 0.391 0.457
##  6 0.390 0.457
##  7 0.387 0.457
##  8 0.387 0.457
##  9 0.383 0.457
## 10 0.382 0.457
## # … with 166 more rows</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>N.train.aug <span class="sc">%&gt;%</span> <span class="fu">rmse</span>(<span class="at">truth =</span> mps, .pred)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard      0.0680</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE = 0.06801068 </span></span></code></pre></div>
<div id="null-model-testing" class="section level3">
<h3>Null model testing</h3>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fitting</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(N.train.fit, test_data)</span></code></pre></div>
<pre><code>## # A tibble: 77 × 1
##    .pred
##    &lt;dbl&gt;
##  1 0.457
##  2 0.457
##  3 0.457
##  4 0.457
##  5 0.457
##  6 0.457
##  7 0.457
##  8 0.457
##  9 0.457
## 10 0.457
## # … with 67 more rows</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>N.test.aug <span class="ot">&lt;-</span> <span class="fu">augment</span>(N.train.fit, test_data) </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>N.test.aug <span class="sc">%&gt;%</span> <span class="fu">select</span>(mps, .pred) </span></code></pre></div>
<pre><code>## # A tibble: 77 × 2
##      mps .pred
##    &lt;dbl&gt; &lt;dbl&gt;
##  1 0.456 0.457
##  2 0.452 0.457
##  3 0.437 0.457
##  4 0.434 0.457
##  5 0.412 0.457
##  6 0.395 0.457
##  7 0.383 0.457
##  8 0.380 0.457
##  9 0.377 0.457
## 10 0.468 0.457
## # … with 67 more rows</code></pre>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>N.test.aug <span class="sc">%&gt;%</span> <span class="co">#taking the root-mean square error of the model</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rmse</span>(<span class="at">truth =</span> mps, .pred)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard      0.0672</code></pre>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE = 0.06721659 </span></span></code></pre></div>
</div>
</div>
<div id="model-2-tree" class="section level2">
<h2>Model 2: Tree</h2>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Tuning hyperparameters</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>tune_spec <span class="ot">&lt;-</span> </span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fu">tune</span>(), </span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">&quot;rpart&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>tune_spec <span class="co"># We will come back to these parameters</span></span></code></pre></div>
<pre><code>## Decision Tree Model Specification (regression)
## 
## Main Arguments:
##   cost_complexity = tune()
##   tree_depth = tune()
## 
## Computational engine: rpart</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setting workflow</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>tree.wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(tune_spec) <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(D.rec)</span></code></pre></div>
</div>
<div id="tuning-with-a-grid" class="section level2">
<h2>Tuning with a grid</h2>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grid</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>cores</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>ncores <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makePSOCKcluster</span>(ncores)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>tree_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">cost_complexity</span>(),</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">tree_depth</span>(),</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> <span class="dv">5</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a><span class="co"># tuning</span></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>tree_res <span class="ot">&lt;-</span> tree.wflow <span class="sc">%&gt;%</span> </span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds, <span class="at">grid =</span> tree_grid)</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 50 × 8
##    cost_complexity tree_depth .metric .estimator  mean     n std_err .config    
##              &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;      
##  1    0.0000000001          1 rmse    standard   0.614    25  0.0136 Preprocess…
##  2    0.0000000001          1 rsq     standard   0.632    25  0.0106 Preprocess…
##  3    0.0000000178          1 rmse    standard   0.614    25  0.0136 Preprocess…
##  4    0.0000000178          1 rsq     standard   0.632    25  0.0106 Preprocess…
##  5    0.00000316            1 rmse    standard   0.614    25  0.0136 Preprocess…
##  6    0.00000316            1 rsq     standard   0.632    25  0.0106 Preprocess…
##  7    0.000562              1 rmse    standard   0.614    25  0.0136 Preprocess…
##  8    0.000562              1 rsq     standard   0.632    25  0.0106 Preprocess…
##  9    0.1                   1 rmse    standard   0.614    25  0.0136 Preprocess…
## 10    0.1                   1 rsq     standard   0.632    25  0.0106 Preprocess…
## # … with 40 more rows</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># turn off parallel cluster</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">tree_depth =</span> <span class="fu">factor</span>(tree_depth)) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(cost_complexity, mean, <span class="at">color =</span> tree_depth)) <span class="sc">+</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> .metric, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">nrow =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>()) <span class="sc">+</span></span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>, <span class="at">begin =</span> .<span class="dv">9</span>, <span class="at">end =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lets check out the top 5</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span> <span class="fu">show_best</span>(<span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 8
##   cost_complexity tree_depth .metric .estimator  mean     n std_err .config     
##             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;       
## 1    0.0000000001          8 rmse    standard   0.259    25 0.00917 Preprocesso…
## 2    0.0000000178          8 rmse    standard   0.259    25 0.00917 Preprocesso…
## 3    0.00000316            8 rmse    standard   0.259    25 0.00917 Preprocesso…
## 4    0.0000000001         11 rmse    standard   0.259    25 0.00917 Preprocesso…
## 5    0.0000000178         11 rmse    standard   0.259    25 0.00917 Preprocesso…</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now to pull out the best set of hyperparameter values for our decision tree model</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>best_tree <span class="ot">&lt;-</span> tree_res <span class="sc">%&gt;%</span> <span class="fu">select_best</span>(<span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co"># finalize workflow</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>final_wf <span class="ot">&lt;-</span> tree.wflow <span class="sc">%&gt;%</span> <span class="fu">finalize_workflow</span>(best_tree)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="co"># final fit</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>final_fit <span class="ot">&lt;-</span> final_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(<span class="at">data =</span> train_data) </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>final_fit</span></code></pre></div>
<pre><code>## ══ Workflow [trained] ══════════════════════════════════════════════════════════
## Preprocessor: Recipe
## Model: decision_tree()
## 
## ── Preprocessor ────────────────────────────────────────────────────────────────
## 2 Recipe Steps
## 
## • step_dummy()
## • step_scale()
## 
## ── Model ───────────────────────────────────────────────────────────────────────
## n= 176 
## 
## node), split, n, deviance, yval
##       * denotes terminal node
## 
##   1) root 176 175.00000000 6.697913  
##     2) avg_time_lap&gt;=26.11 130  36.05376000 6.228446  
##       4) avg_time_lap&gt;=32.42 58   7.47878700 5.793831  
##         8) avg_time_lap&gt;=37.035 11   0.10836970 5.250606 *
##         9) avg_time_lap&lt; 37.035 47   3.36467900 5.920968  
##          18) track_length_m&lt; 14.215 26   0.44794260 5.715494  
##            36) time_s&gt;=325.15 18   0.06109299 5.655044 *
##            37) time_s&lt; 325.15 8   0.17307930 5.851506 *
##          19) track_length_m&gt;=14.215 21   0.45994480 6.175366  
##            38) avg_time_lap&gt;=34.415 7   0.05028384 5.986830 *
##            39) avg_time_lap&lt; 34.415 14   0.03643271 6.269633 *
##       5) avg_time_lap&lt; 32.42 72   8.79396900 6.578552  
##        10) time_s&gt;=29.925 51   2.45283700 6.422064  
##          20) track_length_m&gt;=12.43 39   1.62091200 6.353963  
##            40) track_length_m&lt; 13.625 30   0.23420380 6.264969  
##              80) avg_time_lap&gt;=30.68 9   0.05438351 6.189007 *
##              81) avg_time_lap&lt; 30.68 21   0.10563120 6.297524  
##               162) track_length_m&lt; 13.02 14   0.03521699 6.259880 *
##               163) track_length_m&gt;=13.02 7   0.01089504 6.372814 *
##            41) track_length_m&gt;=13.625 9   0.35711570 6.650610 *
##          21) track_length_m&lt; 12.43 12   0.06322134 6.643392 *
##        11) time_s&lt; 29.925 21   2.05913500 6.958595  
##          22) track_length_m&lt; 13.02 7   0.37816590 6.622303 *
##          23) track_length_m&gt;=13.02 14   0.49349810 7.126741 *
##     3) avg_time_lap&lt; 26.11 46  29.32136000 8.024669  
##       6) time_s&gt;=21.5 29   1.54729000 7.486443  
##        12) time_s&gt;=24.36 22   0.17383850 7.379369  
##          24) time_s&gt;=25.865 14   0.06531379 7.343423 *
##          25) time_s&lt; 25.865 8   0.05877888 7.442274 *
##        13) time_s&lt; 24.36 7   0.32851020 7.822961 *
##       7) time_s&lt; 21.5 17   5.04212400 8.942820 *</code></pre>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>tree_res <span class="sc">%&gt;%</span> <span class="fu">show_best</span>(<span class="st">&quot;rmse&quot;</span>, <span class="at">n =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 8
##   cost_complexity tree_depth .metric .estimator  mean     n std_err .config     
##             &lt;dbl&gt;      &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;       
## 1    0.0000000001          8 rmse    standard   0.259    25 0.00917 Preprocesso…</code></pre>
<p>RMSE = 0.2588305</p>
</div>
<div id="visualize" class="section level2">
<h2>Visualize</h2>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(<span class="fu">extract_fit_parsnip</span>(final_fit)<span class="sc">$</span>fit)</span></code></pre></div>
<pre><code>## Warning: Cannot retrieve the data used to build the model (so cannot determine roundint and is.binary for the variables).
## To silence this warning:
##     Call rpart.plot with roundint=FALSE,
##     or rebuild the rpart model with model=TRUE.</code></pre>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="model-3-lasso" class="section level2">
<h2>Model 3: LASSO</h2>
<div id="building-model" class="section level3">
<h3>Building model</h3>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set workflow</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>lasso.mod <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">mode =</span> <span class="st">&quot;regression&quot;</span>, <span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>lasso.wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(lasso.mod) <span class="sc">%&gt;%</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(D.rec)</span></code></pre></div>
</div>
</div>
<div id="train-and-tune-lasso" class="section level2">
<h2>Train and tune LASSO</h2>
<div id="setting-cores" class="section level3">
<h3>Setting cores</h3>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>cores <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">detectCores</span>()</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>cores</span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>ncores <span class="ot">=</span> <span class="dv">4</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makePSOCKcluster</span>(ncores)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="co"># creating grid and tuning</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>lr_reg_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">penalty =</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">0</span>, <span class="at">length.out =</span> <span class="dv">30</span>)) </span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a><span class="co"># tuning on training data</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>lasso.res <span class="ot">&lt;-</span> lasso.wflow <span class="sc">%&gt;%</span> </span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(<span class="at">resamples =</span> folds,</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">grid =</span> lr_reg_grid,</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">control =</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>),</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">metrics =</span> <span class="fu">metric_set</span>(rmse))</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>lasso.res <span class="sc">%&gt;%</span> <span class="fu">autoplot</span>()</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># turn off parallel cluster</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
</div>
</div>
<div id="choosing-the-best-performing-model" class="section level2">
<h2>Choosing the best performing model</h2>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>lasso.top.models <span class="ot">&lt;-</span> lasso.res <span class="sc">%&gt;%</span> </span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select_best</span>(<span class="st">&quot;rmse&quot;</span>) </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>lasso.res <span class="sc">%&gt;%</span> <span class="fu">show_best</span>(<span class="at">n=</span><span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 7
##   penalty .metric .estimator  mean     n std_err .config              
##     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1   0.001 rmse    standard   0.203    25 0.00600 Preprocessor1_Model01</code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># finalize workflow with the best model</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>best.lasso.wflow <span class="ot">&lt;-</span> lasso.wflow <span class="sc">%&gt;%</span> </span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(lasso.top.models)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fitting best performing model</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>best.lasso.fit <span class="ot">&lt;-</span> best.lasso.wflow <span class="sc">%&gt;%</span> </span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(<span class="at">data =</span> train_data)</span></code></pre></div>
<p>RMSE = 0.207073</p>
</div>
<div id="plotting-performance" class="section level2">
<h2>Plotting performance</h2>
<p>This code is borrowed from Dr. Handel</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> best.lasso.fit<span class="sc">$</span>fit<span class="sc">$</span>fit<span class="sc">$</span>fit</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, <span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-21-1.png" width="672" /> Let us figure out what type of model we should watch. Here are the RMSE of all: - Null: RMSE = 0.06721659 # Maybe because I did not normalize the outcome like I did in other models? - Tree Model: RMSE = 0.2588305 - LASSO: RMSE = 0.207073</p>
<p>Looks like tree model</p>
</div>
</div>
<div id="final-model" class="section level1">
<h1>Final model</h1>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>cl <span class="ot">&lt;-</span> <span class="fu">makePSOCKcluster</span>(ncores)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="fu">registerDoParallel</span>(cl)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># use test data</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>final.mod <span class="ot">&lt;-</span> best.lasso.wflow <span class="sc">%&gt;%</span> <span class="fu">last_fit</span>(data_split) <span class="co"># using test data</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>final.mod <span class="sc">%&gt;%</span> <span class="fu">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   .metric .estimator .estimate .config             
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard       0.213 Preprocessor1_Model1
## 2 rsq     standard       0.956 Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># turn off parallel cluster</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stopCluster</span>(cl)</span></code></pre></div>
<p>RMSE = 0.213288, different from null, but similar to LASSO ## Visualization</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># residuals</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>final.res <span class="ot">&lt;-</span> final.mod <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">augment</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(.pred, mps) <span class="sc">%&gt;%</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">.resid =</span> mps <span class="sc">-</span> .pred)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a><span class="co"># training vs truth</span></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(final.res, <span class="fu">aes</span>(<span class="at">x =</span> mps, <span class="at">y =</span> .pred)) <span class="sc">+</span> </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># residuals vs trth</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(final.res, <span class="fu">aes</span>(<span class="at">y =</span> .resid, <span class="at">x =</span> .pred)) <span class="sc">+</span> </span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="TidyTuesday2_files/figure-html/unnamed-chunk-23-2.png" width="672" /></p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">#compare to null model</span></span></code></pre></div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
